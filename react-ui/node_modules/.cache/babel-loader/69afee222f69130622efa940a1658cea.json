{"ast":null,"code":"'use strict';\n\nvar defaults = require('./core.defaults');\n\nvar Element = require('./core.element');\n\nvar helpers = require('../helpers/index');\n\ndefaults._set('global', {\n  tooltips: {\n    enabled: true,\n    custom: null,\n    mode: 'nearest',\n    position: 'average',\n    intersect: true,\n    backgroundColor: 'rgba(0,0,0,0.8)',\n    titleFontStyle: 'bold',\n    titleSpacing: 2,\n    titleMarginBottom: 6,\n    titleFontColor: '#fff',\n    titleAlign: 'left',\n    bodySpacing: 2,\n    bodyFontColor: '#fff',\n    bodyAlign: 'left',\n    footerFontStyle: 'bold',\n    footerSpacing: 2,\n    footerMarginTop: 6,\n    footerFontColor: '#fff',\n    footerAlign: 'left',\n    yPadding: 6,\n    xPadding: 6,\n    caretPadding: 2,\n    caretSize: 5,\n    cornerRadius: 6,\n    multiKeyBackground: '#fff',\n    displayColors: true,\n    borderColor: 'rgba(0,0,0,0)',\n    borderWidth: 0,\n    callbacks: {\n      // Args are: (tooltipItems, data)\n      beforeTitle: helpers.noop,\n      title: function title(tooltipItems, data) {\n        // Pick first xLabel for now\n        var title = '';\n        var labels = data.labels;\n        var labelCount = labels ? labels.length : 0;\n\n        if (tooltipItems.length > 0) {\n          var item = tooltipItems[0];\n\n          if (item.xLabel) {\n            title = item.xLabel;\n          } else if (labelCount > 0 && item.index < labelCount) {\n            title = labels[item.index];\n          }\n        }\n\n        return title;\n      },\n      afterTitle: helpers.noop,\n      // Args are: (tooltipItems, data)\n      beforeBody: helpers.noop,\n      // Args are: (tooltipItem, data)\n      beforeLabel: helpers.noop,\n      label: function label(tooltipItem, data) {\n        var label = data.datasets[tooltipItem.datasetIndex].label || '';\n\n        if (label) {\n          label += ': ';\n        }\n\n        label += tooltipItem.yLabel;\n        return label;\n      },\n      labelColor: function labelColor(tooltipItem, chart) {\n        var meta = chart.getDatasetMeta(tooltipItem.datasetIndex);\n        var activeElement = meta.data[tooltipItem.index];\n        var view = activeElement._view;\n        return {\n          borderColor: view.borderColor,\n          backgroundColor: view.backgroundColor\n        };\n      },\n      labelTextColor: function labelTextColor() {\n        return this._options.bodyFontColor;\n      },\n      afterLabel: helpers.noop,\n      // Args are: (tooltipItems, data)\n      afterBody: helpers.noop,\n      // Args are: (tooltipItems, data)\n      beforeFooter: helpers.noop,\n      footer: helpers.noop,\n      afterFooter: helpers.noop\n    }\n  }\n});\n\nmodule.exports = function (Chart) {\n  /**\n  \t * Helper method to merge the opacity into a color\n  \t */\n  function mergeOpacity(colorString, opacity) {\n    var color = helpers.color(colorString);\n    return color.alpha(opacity * color.alpha()).rgbaString();\n  } // Helper to push or concat based on if the 2nd parameter is an array or not\n\n\n  function pushOrConcat(base, toPush) {\n    if (toPush) {\n      if (helpers.isArray(toPush)) {\n        // base = base.concat(toPush);\n        Array.prototype.push.apply(base, toPush);\n      } else {\n        base.push(toPush);\n      }\n    }\n\n    return base;\n  } // Private helper to create a tooltip item model\n  // @param element : the chart element (point, arc, bar) to create the tooltip item for\n  // @return : new tooltip item\n\n\n  function createTooltipItem(element) {\n    var xScale = element._xScale;\n    var yScale = element._yScale || element._scale; // handle radar || polarArea charts\n\n    var index = element._index;\n    var datasetIndex = element._datasetIndex;\n    return {\n      xLabel: xScale ? xScale.getLabelForIndex(index, datasetIndex) : '',\n      yLabel: yScale ? yScale.getLabelForIndex(index, datasetIndex) : '',\n      index: index,\n      datasetIndex: datasetIndex,\n      x: element._model.x,\n      y: element._model.y\n    };\n  }\n  /**\n   * Helper to get the reset model for the tooltip\n   * @param tooltipOpts {Object} the tooltip options\n   */\n\n\n  function getBaseModel(tooltipOpts) {\n    var globalDefaults = defaults.global;\n    var valueOrDefault = helpers.valueOrDefault;\n    return {\n      // Positioning\n      xPadding: tooltipOpts.xPadding,\n      yPadding: tooltipOpts.yPadding,\n      xAlign: tooltipOpts.xAlign,\n      yAlign: tooltipOpts.yAlign,\n      // Body\n      bodyFontColor: tooltipOpts.bodyFontColor,\n      _bodyFontFamily: valueOrDefault(tooltipOpts.bodyFontFamily, globalDefaults.defaultFontFamily),\n      _bodyFontStyle: valueOrDefault(tooltipOpts.bodyFontStyle, globalDefaults.defaultFontStyle),\n      _bodyAlign: tooltipOpts.bodyAlign,\n      bodyFontSize: valueOrDefault(tooltipOpts.bodyFontSize, globalDefaults.defaultFontSize),\n      bodySpacing: tooltipOpts.bodySpacing,\n      // Title\n      titleFontColor: tooltipOpts.titleFontColor,\n      _titleFontFamily: valueOrDefault(tooltipOpts.titleFontFamily, globalDefaults.defaultFontFamily),\n      _titleFontStyle: valueOrDefault(tooltipOpts.titleFontStyle, globalDefaults.defaultFontStyle),\n      titleFontSize: valueOrDefault(tooltipOpts.titleFontSize, globalDefaults.defaultFontSize),\n      _titleAlign: tooltipOpts.titleAlign,\n      titleSpacing: tooltipOpts.titleSpacing,\n      titleMarginBottom: tooltipOpts.titleMarginBottom,\n      // Footer\n      footerFontColor: tooltipOpts.footerFontColor,\n      _footerFontFamily: valueOrDefault(tooltipOpts.footerFontFamily, globalDefaults.defaultFontFamily),\n      _footerFontStyle: valueOrDefault(tooltipOpts.footerFontStyle, globalDefaults.defaultFontStyle),\n      footerFontSize: valueOrDefault(tooltipOpts.footerFontSize, globalDefaults.defaultFontSize),\n      _footerAlign: tooltipOpts.footerAlign,\n      footerSpacing: tooltipOpts.footerSpacing,\n      footerMarginTop: tooltipOpts.footerMarginTop,\n      // Appearance\n      caretSize: tooltipOpts.caretSize,\n      cornerRadius: tooltipOpts.cornerRadius,\n      backgroundColor: tooltipOpts.backgroundColor,\n      opacity: 0,\n      legendColorBackground: tooltipOpts.multiKeyBackground,\n      displayColors: tooltipOpts.displayColors,\n      borderColor: tooltipOpts.borderColor,\n      borderWidth: tooltipOpts.borderWidth\n    };\n  }\n  /**\n   * Get the size of the tooltip\n   */\n\n\n  function getTooltipSize(tooltip, model) {\n    var ctx = tooltip._chart.ctx;\n    var height = model.yPadding * 2; // Tooltip Padding\n\n    var width = 0; // Count of all lines in the body\n\n    var body = model.body;\n    var combinedBodyLength = body.reduce(function (count, bodyItem) {\n      return count + bodyItem.before.length + bodyItem.lines.length + bodyItem.after.length;\n    }, 0);\n    combinedBodyLength += model.beforeBody.length + model.afterBody.length;\n    var titleLineCount = model.title.length;\n    var footerLineCount = model.footer.length;\n    var titleFontSize = model.titleFontSize;\n    var bodyFontSize = model.bodyFontSize;\n    var footerFontSize = model.footerFontSize;\n    height += titleLineCount * titleFontSize; // Title Lines\n\n    height += titleLineCount ? (titleLineCount - 1) * model.titleSpacing : 0; // Title Line Spacing\n\n    height += titleLineCount ? model.titleMarginBottom : 0; // Title's bottom Margin\n\n    height += combinedBodyLength * bodyFontSize; // Body Lines\n\n    height += combinedBodyLength ? (combinedBodyLength - 1) * model.bodySpacing : 0; // Body Line Spacing\n\n    height += footerLineCount ? model.footerMarginTop : 0; // Footer Margin\n\n    height += footerLineCount * footerFontSize; // Footer Lines\n\n    height += footerLineCount ? (footerLineCount - 1) * model.footerSpacing : 0; // Footer Line Spacing\n    // Title width\n\n    var widthPadding = 0;\n\n    var maxLineWidth = function maxLineWidth(line) {\n      width = Math.max(width, ctx.measureText(line).width + widthPadding);\n    };\n\n    ctx.font = helpers.fontString(titleFontSize, model._titleFontStyle, model._titleFontFamily);\n    helpers.each(model.title, maxLineWidth); // Body width\n\n    ctx.font = helpers.fontString(bodyFontSize, model._bodyFontStyle, model._bodyFontFamily);\n    helpers.each(model.beforeBody.concat(model.afterBody), maxLineWidth); // Body lines may include some extra width due to the color box\n\n    widthPadding = model.displayColors ? bodyFontSize + 2 : 0;\n    helpers.each(body, function (bodyItem) {\n      helpers.each(bodyItem.before, maxLineWidth);\n      helpers.each(bodyItem.lines, maxLineWidth);\n      helpers.each(bodyItem.after, maxLineWidth);\n    }); // Reset back to 0\n\n    widthPadding = 0; // Footer width\n\n    ctx.font = helpers.fontString(footerFontSize, model._footerFontStyle, model._footerFontFamily);\n    helpers.each(model.footer, maxLineWidth); // Add padding\n\n    width += 2 * model.xPadding;\n    return {\n      width: width,\n      height: height\n    };\n  }\n  /**\n   * Helper to get the alignment of a tooltip given the size\n   */\n\n\n  function determineAlignment(tooltip, size) {\n    var model = tooltip._model;\n    var chart = tooltip._chart;\n    var chartArea = tooltip._chart.chartArea;\n    var xAlign = 'center';\n    var yAlign = 'center';\n\n    if (model.y < size.height) {\n      yAlign = 'top';\n    } else if (model.y > chart.height - size.height) {\n      yAlign = 'bottom';\n    }\n\n    var lf, rf; // functions to determine left, right alignment\n\n    var olf, orf; // functions to determine if left/right alignment causes tooltip to go outside chart\n\n    var yf; // function to get the y alignment if the tooltip goes outside of the left or right edges\n\n    var midX = (chartArea.left + chartArea.right) / 2;\n    var midY = (chartArea.top + chartArea.bottom) / 2;\n\n    if (yAlign === 'center') {\n      lf = function lf(x) {\n        return x <= midX;\n      };\n\n      rf = function rf(x) {\n        return x > midX;\n      };\n    } else {\n      lf = function lf(x) {\n        return x <= size.width / 2;\n      };\n\n      rf = function rf(x) {\n        return x >= chart.width - size.width / 2;\n      };\n    }\n\n    olf = function olf(x) {\n      return x + size.width + model.caretSize + model.caretPadding > chart.width;\n    };\n\n    orf = function orf(x) {\n      return x - size.width - model.caretSize - model.caretPadding < 0;\n    };\n\n    yf = function yf(y) {\n      return y <= midY ? 'top' : 'bottom';\n    };\n\n    if (lf(model.x)) {\n      xAlign = 'left'; // Is tooltip too wide and goes over the right side of the chart.?\n\n      if (olf(model.x)) {\n        xAlign = 'center';\n        yAlign = yf(model.y);\n      }\n    } else if (rf(model.x)) {\n      xAlign = 'right'; // Is tooltip too wide and goes outside left edge of canvas?\n\n      if (orf(model.x)) {\n        xAlign = 'center';\n        yAlign = yf(model.y);\n      }\n    }\n\n    var opts = tooltip._options;\n    return {\n      xAlign: opts.xAlign ? opts.xAlign : xAlign,\n      yAlign: opts.yAlign ? opts.yAlign : yAlign\n    };\n  }\n  /**\n   * @Helper to get the location a tooltip needs to be placed at given the initial position (via the vm) and the size and alignment\n   */\n\n\n  function getBackgroundPoint(vm, size, alignment, chart) {\n    // Background Position\n    var x = vm.x;\n    var y = vm.y;\n    var caretSize = vm.caretSize;\n    var caretPadding = vm.caretPadding;\n    var cornerRadius = vm.cornerRadius;\n    var xAlign = alignment.xAlign;\n    var yAlign = alignment.yAlign;\n    var paddingAndSize = caretSize + caretPadding;\n    var radiusAndPadding = cornerRadius + caretPadding;\n\n    if (xAlign === 'right') {\n      x -= size.width;\n    } else if (xAlign === 'center') {\n      x -= size.width / 2;\n\n      if (x + size.width > chart.width) {\n        x = chart.width - size.width;\n      }\n\n      if (x < 0) {\n        x = 0;\n      }\n    }\n\n    if (yAlign === 'top') {\n      y += paddingAndSize;\n    } else if (yAlign === 'bottom') {\n      y -= size.height + paddingAndSize;\n    } else {\n      y -= size.height / 2;\n    }\n\n    if (yAlign === 'center') {\n      if (xAlign === 'left') {\n        x += paddingAndSize;\n      } else if (xAlign === 'right') {\n        x -= paddingAndSize;\n      }\n    } else if (xAlign === 'left') {\n      x -= radiusAndPadding;\n    } else if (xAlign === 'right') {\n      x += radiusAndPadding;\n    }\n\n    return {\n      x: x,\n      y: y\n    };\n  }\n\n  Chart.Tooltip = Element.extend({\n    initialize: function initialize() {\n      this._model = getBaseModel(this._options);\n      this._lastActive = [];\n    },\n    // Get the title\n    // Args are: (tooltipItem, data)\n    getTitle: function getTitle() {\n      var me = this;\n      var opts = me._options;\n      var callbacks = opts.callbacks;\n      var beforeTitle = callbacks.beforeTitle.apply(me, arguments);\n      var title = callbacks.title.apply(me, arguments);\n      var afterTitle = callbacks.afterTitle.apply(me, arguments);\n      var lines = [];\n      lines = pushOrConcat(lines, beforeTitle);\n      lines = pushOrConcat(lines, title);\n      lines = pushOrConcat(lines, afterTitle);\n      return lines;\n    },\n    // Args are: (tooltipItem, data)\n    getBeforeBody: function getBeforeBody() {\n      var lines = this._options.callbacks.beforeBody.apply(this, arguments);\n\n      return helpers.isArray(lines) ? lines : lines !== undefined ? [lines] : [];\n    },\n    // Args are: (tooltipItem, data)\n    getBody: function getBody(tooltipItems, data) {\n      var me = this;\n      var callbacks = me._options.callbacks;\n      var bodyItems = [];\n      helpers.each(tooltipItems, function (tooltipItem) {\n        var bodyItem = {\n          before: [],\n          lines: [],\n          after: []\n        };\n        pushOrConcat(bodyItem.before, callbacks.beforeLabel.call(me, tooltipItem, data));\n        pushOrConcat(bodyItem.lines, callbacks.label.call(me, tooltipItem, data));\n        pushOrConcat(bodyItem.after, callbacks.afterLabel.call(me, tooltipItem, data));\n        bodyItems.push(bodyItem);\n      });\n      return bodyItems;\n    },\n    // Args are: (tooltipItem, data)\n    getAfterBody: function getAfterBody() {\n      var lines = this._options.callbacks.afterBody.apply(this, arguments);\n\n      return helpers.isArray(lines) ? lines : lines !== undefined ? [lines] : [];\n    },\n    // Get the footer and beforeFooter and afterFooter lines\n    // Args are: (tooltipItem, data)\n    getFooter: function getFooter() {\n      var me = this;\n      var callbacks = me._options.callbacks;\n      var beforeFooter = callbacks.beforeFooter.apply(me, arguments);\n      var footer = callbacks.footer.apply(me, arguments);\n      var afterFooter = callbacks.afterFooter.apply(me, arguments);\n      var lines = [];\n      lines = pushOrConcat(lines, beforeFooter);\n      lines = pushOrConcat(lines, footer);\n      lines = pushOrConcat(lines, afterFooter);\n      return lines;\n    },\n    update: function update(changed) {\n      var me = this;\n      var opts = me._options; // Need to regenerate the model because its faster than using extend and it is necessary due to the optimization in Chart.Element.transition\n      // that does _view = _model if ease === 1. This causes the 2nd tooltip update to set properties in both the view and model at the same time\n      // which breaks any animations.\n\n      var existingModel = me._model;\n      var model = me._model = getBaseModel(opts);\n      var active = me._active;\n      var data = me._data; // In the case where active.length === 0 we need to keep these at existing values for good animations\n\n      var alignment = {\n        xAlign: existingModel.xAlign,\n        yAlign: existingModel.yAlign\n      };\n      var backgroundPoint = {\n        x: existingModel.x,\n        y: existingModel.y\n      };\n      var tooltipSize = {\n        width: existingModel.width,\n        height: existingModel.height\n      };\n      var tooltipPosition = {\n        x: existingModel.caretX,\n        y: existingModel.caretY\n      };\n      var i, len;\n\n      if (active.length) {\n        model.opacity = 1;\n        var labelColors = [];\n        var labelTextColors = [];\n        tooltipPosition = Chart.Tooltip.positioners[opts.position].call(me, active, me._eventPosition);\n        var tooltipItems = [];\n\n        for (i = 0, len = active.length; i < len; ++i) {\n          tooltipItems.push(createTooltipItem(active[i]));\n        } // If the user provided a filter function, use it to modify the tooltip items\n\n\n        if (opts.filter) {\n          tooltipItems = tooltipItems.filter(function (a) {\n            return opts.filter(a, data);\n          });\n        } // If the user provided a sorting function, use it to modify the tooltip items\n\n\n        if (opts.itemSort) {\n          tooltipItems = tooltipItems.sort(function (a, b) {\n            return opts.itemSort(a, b, data);\n          });\n        } // Determine colors for boxes\n\n\n        helpers.each(tooltipItems, function (tooltipItem) {\n          labelColors.push(opts.callbacks.labelColor.call(me, tooltipItem, me._chart));\n          labelTextColors.push(opts.callbacks.labelTextColor.call(me, tooltipItem, me._chart));\n        }); // Build the Text Lines\n\n        model.title = me.getTitle(tooltipItems, data);\n        model.beforeBody = me.getBeforeBody(tooltipItems, data);\n        model.body = me.getBody(tooltipItems, data);\n        model.afterBody = me.getAfterBody(tooltipItems, data);\n        model.footer = me.getFooter(tooltipItems, data); // Initial positioning and colors\n\n        model.x = Math.round(tooltipPosition.x);\n        model.y = Math.round(tooltipPosition.y);\n        model.caretPadding = opts.caretPadding;\n        model.labelColors = labelColors;\n        model.labelTextColors = labelTextColors; // data points\n\n        model.dataPoints = tooltipItems; // We need to determine alignment of the tooltip\n\n        tooltipSize = getTooltipSize(this, model);\n        alignment = determineAlignment(this, tooltipSize); // Final Size and Position\n\n        backgroundPoint = getBackgroundPoint(model, tooltipSize, alignment, me._chart);\n      } else {\n        model.opacity = 0;\n      }\n\n      model.xAlign = alignment.xAlign;\n      model.yAlign = alignment.yAlign;\n      model.x = backgroundPoint.x;\n      model.y = backgroundPoint.y;\n      model.width = tooltipSize.width;\n      model.height = tooltipSize.height; // Point where the caret on the tooltip points to\n\n      model.caretX = tooltipPosition.x;\n      model.caretY = tooltipPosition.y;\n      me._model = model;\n\n      if (changed && opts.custom) {\n        opts.custom.call(me, model);\n      }\n\n      return me;\n    },\n    drawCaret: function drawCaret(tooltipPoint, size) {\n      var ctx = this._chart.ctx;\n      var vm = this._view;\n      var caretPosition = this.getCaretPosition(tooltipPoint, size, vm);\n      ctx.lineTo(caretPosition.x1, caretPosition.y1);\n      ctx.lineTo(caretPosition.x2, caretPosition.y2);\n      ctx.lineTo(caretPosition.x3, caretPosition.y3);\n    },\n    getCaretPosition: function getCaretPosition(tooltipPoint, size, vm) {\n      var x1, x2, x3, y1, y2, y3;\n      var caretSize = vm.caretSize;\n      var cornerRadius = vm.cornerRadius;\n      var xAlign = vm.xAlign;\n      var yAlign = vm.yAlign;\n      var ptX = tooltipPoint.x;\n      var ptY = tooltipPoint.y;\n      var width = size.width;\n      var height = size.height;\n\n      if (yAlign === 'center') {\n        y2 = ptY + height / 2;\n\n        if (xAlign === 'left') {\n          x1 = ptX;\n          x2 = x1 - caretSize;\n          x3 = x1;\n          y1 = y2 + caretSize;\n          y3 = y2 - caretSize;\n        } else {\n          x1 = ptX + width;\n          x2 = x1 + caretSize;\n          x3 = x1;\n          y1 = y2 - caretSize;\n          y3 = y2 + caretSize;\n        }\n      } else {\n        if (xAlign === 'left') {\n          x2 = ptX + cornerRadius + caretSize;\n          x1 = x2 - caretSize;\n          x3 = x2 + caretSize;\n        } else if (xAlign === 'right') {\n          x2 = ptX + width - cornerRadius - caretSize;\n          x1 = x2 - caretSize;\n          x3 = x2 + caretSize;\n        } else {\n          x2 = vm.caretX;\n          x1 = x2 - caretSize;\n          x3 = x2 + caretSize;\n        }\n\n        if (yAlign === 'top') {\n          y1 = ptY;\n          y2 = y1 - caretSize;\n          y3 = y1;\n        } else {\n          y1 = ptY + height;\n          y2 = y1 + caretSize;\n          y3 = y1; // invert drawing order\n\n          var tmp = x3;\n          x3 = x1;\n          x1 = tmp;\n        }\n      }\n\n      return {\n        x1: x1,\n        x2: x2,\n        x3: x3,\n        y1: y1,\n        y2: y2,\n        y3: y3\n      };\n    },\n    drawTitle: function drawTitle(pt, vm, ctx, opacity) {\n      var title = vm.title;\n\n      if (title.length) {\n        ctx.textAlign = vm._titleAlign;\n        ctx.textBaseline = 'top';\n        var titleFontSize = vm.titleFontSize;\n        var titleSpacing = vm.titleSpacing;\n        ctx.fillStyle = mergeOpacity(vm.titleFontColor, opacity);\n        ctx.font = helpers.fontString(titleFontSize, vm._titleFontStyle, vm._titleFontFamily);\n        var i, len;\n\n        for (i = 0, len = title.length; i < len; ++i) {\n          ctx.fillText(title[i], pt.x, pt.y);\n          pt.y += titleFontSize + titleSpacing; // Line Height and spacing\n\n          if (i + 1 === title.length) {\n            pt.y += vm.titleMarginBottom - titleSpacing; // If Last, add margin, remove spacing\n          }\n        }\n      }\n    },\n    drawBody: function drawBody(pt, vm, ctx, opacity) {\n      var bodyFontSize = vm.bodyFontSize;\n      var bodySpacing = vm.bodySpacing;\n      var body = vm.body;\n      ctx.textAlign = vm._bodyAlign;\n      ctx.textBaseline = 'top';\n      ctx.font = helpers.fontString(bodyFontSize, vm._bodyFontStyle, vm._bodyFontFamily); // Before Body\n\n      var xLinePadding = 0;\n\n      var fillLineOfText = function fillLineOfText(line) {\n        ctx.fillText(line, pt.x + xLinePadding, pt.y);\n        pt.y += bodyFontSize + bodySpacing;\n      }; // Before body lines\n\n\n      ctx.fillStyle = mergeOpacity(vm.bodyFontColor, opacity);\n      helpers.each(vm.beforeBody, fillLineOfText);\n      var drawColorBoxes = vm.displayColors;\n      xLinePadding = drawColorBoxes ? bodyFontSize + 2 : 0; // Draw body lines now\n\n      helpers.each(body, function (bodyItem, i) {\n        var textColor = mergeOpacity(vm.labelTextColors[i], opacity);\n        ctx.fillStyle = textColor;\n        helpers.each(bodyItem.before, fillLineOfText);\n        helpers.each(bodyItem.lines, function (line) {\n          // Draw Legend-like boxes if needed\n          if (drawColorBoxes) {\n            // Fill a white rect so that colours merge nicely if the opacity is < 1\n            ctx.fillStyle = mergeOpacity(vm.legendColorBackground, opacity);\n            ctx.fillRect(pt.x, pt.y, bodyFontSize, bodyFontSize); // Border\n\n            ctx.lineWidth = 1;\n            ctx.strokeStyle = mergeOpacity(vm.labelColors[i].borderColor, opacity);\n            ctx.strokeRect(pt.x, pt.y, bodyFontSize, bodyFontSize); // Inner square\n\n            ctx.fillStyle = mergeOpacity(vm.labelColors[i].backgroundColor, opacity);\n            ctx.fillRect(pt.x + 1, pt.y + 1, bodyFontSize - 2, bodyFontSize - 2);\n            ctx.fillStyle = textColor;\n          }\n\n          fillLineOfText(line);\n        });\n        helpers.each(bodyItem.after, fillLineOfText);\n      }); // Reset back to 0 for after body\n\n      xLinePadding = 0; // After body lines\n\n      helpers.each(vm.afterBody, fillLineOfText);\n      pt.y -= bodySpacing; // Remove last body spacing\n    },\n    drawFooter: function drawFooter(pt, vm, ctx, opacity) {\n      var footer = vm.footer;\n\n      if (footer.length) {\n        pt.y += vm.footerMarginTop;\n        ctx.textAlign = vm._footerAlign;\n        ctx.textBaseline = 'top';\n        ctx.fillStyle = mergeOpacity(vm.footerFontColor, opacity);\n        ctx.font = helpers.fontString(vm.footerFontSize, vm._footerFontStyle, vm._footerFontFamily);\n        helpers.each(footer, function (line) {\n          ctx.fillText(line, pt.x, pt.y);\n          pt.y += vm.footerFontSize + vm.footerSpacing;\n        });\n      }\n    },\n    drawBackground: function drawBackground(pt, vm, ctx, tooltipSize, opacity) {\n      ctx.fillStyle = mergeOpacity(vm.backgroundColor, opacity);\n      ctx.strokeStyle = mergeOpacity(vm.borderColor, opacity);\n      ctx.lineWidth = vm.borderWidth;\n      var xAlign = vm.xAlign;\n      var yAlign = vm.yAlign;\n      var x = pt.x;\n      var y = pt.y;\n      var width = tooltipSize.width;\n      var height = tooltipSize.height;\n      var radius = vm.cornerRadius;\n      ctx.beginPath();\n      ctx.moveTo(x + radius, y);\n\n      if (yAlign === 'top') {\n        this.drawCaret(pt, tooltipSize);\n      }\n\n      ctx.lineTo(x + width - radius, y);\n      ctx.quadraticCurveTo(x + width, y, x + width, y + radius);\n\n      if (yAlign === 'center' && xAlign === 'right') {\n        this.drawCaret(pt, tooltipSize);\n      }\n\n      ctx.lineTo(x + width, y + height - radius);\n      ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n\n      if (yAlign === 'bottom') {\n        this.drawCaret(pt, tooltipSize);\n      }\n\n      ctx.lineTo(x + radius, y + height);\n      ctx.quadraticCurveTo(x, y + height, x, y + height - radius);\n\n      if (yAlign === 'center' && xAlign === 'left') {\n        this.drawCaret(pt, tooltipSize);\n      }\n\n      ctx.lineTo(x, y + radius);\n      ctx.quadraticCurveTo(x, y, x + radius, y);\n      ctx.closePath();\n      ctx.fill();\n\n      if (vm.borderWidth > 0) {\n        ctx.stroke();\n      }\n    },\n    draw: function draw() {\n      var ctx = this._chart.ctx;\n      var vm = this._view;\n\n      if (vm.opacity === 0) {\n        return;\n      }\n\n      var tooltipSize = {\n        width: vm.width,\n        height: vm.height\n      };\n      var pt = {\n        x: vm.x,\n        y: vm.y\n      }; // IE11/Edge does not like very small opacities, so snap to 0\n\n      var opacity = Math.abs(vm.opacity < 1e-3) ? 0 : vm.opacity; // Truthy/falsey value for empty tooltip\n\n      var hasTooltipContent = vm.title.length || vm.beforeBody.length || vm.body.length || vm.afterBody.length || vm.footer.length;\n\n      if (this._options.enabled && hasTooltipContent) {\n        // Draw Background\n        this.drawBackground(pt, vm, ctx, tooltipSize, opacity); // Draw Title, Body, and Footer\n\n        pt.x += vm.xPadding;\n        pt.y += vm.yPadding; // Titles\n\n        this.drawTitle(pt, vm, ctx, opacity); // Body\n\n        this.drawBody(pt, vm, ctx, opacity); // Footer\n\n        this.drawFooter(pt, vm, ctx, opacity);\n      }\n    },\n\n    /**\n     * Handle an event\n     * @private\n     * @param {IEvent} event - The event to handle\n     * @returns {Boolean} true if the tooltip changed\n     */\n    handleEvent: function handleEvent(e) {\n      var me = this;\n      var options = me._options;\n      var changed = false;\n      me._lastActive = me._lastActive || []; // Find Active Elements for tooltips\n\n      if (e.type === 'mouseout') {\n        me._active = [];\n      } else {\n        me._active = me._chart.getElementsAtEventForMode(e, options.mode, options);\n      } // Remember Last Actives\n\n\n      changed = !helpers.arrayEquals(me._active, me._lastActive); // Only handle target event on tooltip change\n\n      if (changed) {\n        me._lastActive = me._active;\n\n        if (options.enabled || options.custom) {\n          me._eventPosition = {\n            x: e.x,\n            y: e.y\n          };\n          me.update(true);\n          me.pivot();\n        }\n      }\n\n      return changed;\n    }\n  });\n  /**\n   * @namespace Chart.Tooltip.positioners\n   */\n\n  Chart.Tooltip.positioners = {\n    /**\n     * Average mode places the tooltip at the average position of the elements shown\n     * @function Chart.Tooltip.positioners.average\n     * @param elements {ChartElement[]} the elements being displayed in the tooltip\n     * @returns {Point} tooltip position\n     */\n    average: function average(elements) {\n      if (!elements.length) {\n        return false;\n      }\n\n      var i, len;\n      var x = 0;\n      var y = 0;\n      var count = 0;\n\n      for (i = 0, len = elements.length; i < len; ++i) {\n        var el = elements[i];\n\n        if (el && el.hasValue()) {\n          var pos = el.tooltipPosition();\n          x += pos.x;\n          y += pos.y;\n          ++count;\n        }\n      }\n\n      return {\n        x: Math.round(x / count),\n        y: Math.round(y / count)\n      };\n    },\n\n    /**\n     * Gets the tooltip position nearest of the item nearest to the event position\n     * @function Chart.Tooltip.positioners.nearest\n     * @param elements {Chart.Element[]} the tooltip elements\n     * @param eventPosition {Point} the position of the event in canvas coordinates\n     * @returns {Point} the tooltip position\n     */\n    nearest: function nearest(elements, eventPosition) {\n      var x = eventPosition.x;\n      var y = eventPosition.y;\n      var minDistance = Number.POSITIVE_INFINITY;\n      var i, len, nearestElement;\n\n      for (i = 0, len = elements.length; i < len; ++i) {\n        var el = elements[i];\n\n        if (el && el.hasValue()) {\n          var center = el.getCenterPoint();\n          var d = helpers.distanceBetweenPoints(eventPosition, center);\n\n          if (d < minDistance) {\n            minDistance = d;\n            nearestElement = el;\n          }\n        }\n      }\n\n      if (nearestElement) {\n        var tp = nearestElement.tooltipPosition();\n        x = tp.x;\n        y = tp.y;\n      }\n\n      return {\n        x: x,\n        y: y\n      };\n    }\n  };\n};","map":{"version":3,"sources":["/home/mohamed/projects/ESense/react-ui/node_modules/chart.js/src/core/core.tooltip.js"],"names":["defaults","require","Element","helpers","_set","tooltips","enabled","custom","mode","position","intersect","backgroundColor","titleFontStyle","titleSpacing","titleMarginBottom","titleFontColor","titleAlign","bodySpacing","bodyFontColor","bodyAlign","footerFontStyle","footerSpacing","footerMarginTop","footerFontColor","footerAlign","yPadding","xPadding","caretPadding","caretSize","cornerRadius","multiKeyBackground","displayColors","borderColor","borderWidth","callbacks","beforeTitle","noop","title","tooltipItems","data","labels","labelCount","length","item","xLabel","index","afterTitle","beforeBody","beforeLabel","label","tooltipItem","datasets","datasetIndex","yLabel","labelColor","chart","meta","getDatasetMeta","activeElement","view","_view","labelTextColor","_options","afterLabel","afterBody","beforeFooter","footer","afterFooter","module","exports","Chart","mergeOpacity","colorString","opacity","color","alpha","rgbaString","pushOrConcat","base","toPush","isArray","Array","prototype","push","apply","createTooltipItem","element","xScale","_xScale","yScale","_yScale","_scale","_index","_datasetIndex","getLabelForIndex","x","_model","y","getBaseModel","tooltipOpts","globalDefaults","global","valueOrDefault","xAlign","yAlign","_bodyFontFamily","bodyFontFamily","defaultFontFamily","_bodyFontStyle","bodyFontStyle","defaultFontStyle","_bodyAlign","bodyFontSize","defaultFontSize","_titleFontFamily","titleFontFamily","_titleFontStyle","titleFontSize","_titleAlign","_footerFontFamily","footerFontFamily","_footerFontStyle","footerFontSize","_footerAlign","legendColorBackground","getTooltipSize","tooltip","model","ctx","_chart","height","width","body","combinedBodyLength","reduce","count","bodyItem","before","lines","after","titleLineCount","footerLineCount","widthPadding","maxLineWidth","line","Math","max","measureText","font","fontString","each","concat","determineAlignment","size","chartArea","lf","rf","olf","orf","yf","midX","left","right","midY","top","bottom","opts","getBackgroundPoint","vm","alignment","paddingAndSize","radiusAndPadding","Tooltip","extend","initialize","_lastActive","getTitle","me","arguments","getBeforeBody","undefined","getBody","bodyItems","call","getAfterBody","getFooter","update","changed","existingModel","active","_active","_data","backgroundPoint","tooltipSize","tooltipPosition","caretX","caretY","i","len","labelColors","labelTextColors","positioners","_eventPosition","filter","a","itemSort","sort","b","round","dataPoints","drawCaret","tooltipPoint","caretPosition","getCaretPosition","lineTo","x1","y1","x2","y2","x3","y3","ptX","ptY","tmp","drawTitle","pt","textAlign","textBaseline","fillStyle","fillText","drawBody","xLinePadding","fillLineOfText","drawColorBoxes","textColor","fillRect","lineWidth","strokeStyle","strokeRect","drawFooter","drawBackground","radius","beginPath","moveTo","quadraticCurveTo","closePath","fill","stroke","draw","abs","hasTooltipContent","handleEvent","e","options","type","getElementsAtEventForMode","arrayEquals","pivot","average","elements","el","hasValue","pos","nearest","eventPosition","minDistance","Number","POSITIVE_INFINITY","nearestElement","center","getCenterPoint","d","distanceBetweenPoints","tp"],"mappings":"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","sourcesContent":["'use strict';\n\nvar defaults = require('./core.defaults');\nvar Element = require('./core.element');\nvar helpers = require('../helpers/index');\n\ndefaults._set('global', {\n\ttooltips: {\n\t\tenabled: true,\n\t\tcustom: null,\n\t\tmode: 'nearest',\n\t\tposition: 'average',\n\t\tintersect: true,\n\t\tbackgroundColor: 'rgba(0,0,0,0.8)',\n\t\ttitleFontStyle: 'bold',\n\t\ttitleSpacing: 2,\n\t\ttitleMarginBottom: 6,\n\t\ttitleFontColor: '#fff',\n\t\ttitleAlign: 'left',\n\t\tbodySpacing: 2,\n\t\tbodyFontColor: '#fff',\n\t\tbodyAlign: 'left',\n\t\tfooterFontStyle: 'bold',\n\t\tfooterSpacing: 2,\n\t\tfooterMarginTop: 6,\n\t\tfooterFontColor: '#fff',\n\t\tfooterAlign: 'left',\n\t\tyPadding: 6,\n\t\txPadding: 6,\n\t\tcaretPadding: 2,\n\t\tcaretSize: 5,\n\t\tcornerRadius: 6,\n\t\tmultiKeyBackground: '#fff',\n\t\tdisplayColors: true,\n\t\tborderColor: 'rgba(0,0,0,0)',\n\t\tborderWidth: 0,\n\t\tcallbacks: {\n\t\t\t// Args are: (tooltipItems, data)\n\t\t\tbeforeTitle: helpers.noop,\n\t\t\ttitle: function(tooltipItems, data) {\n\t\t\t\t// Pick first xLabel for now\n\t\t\t\tvar title = '';\n\t\t\t\tvar labels = data.labels;\n\t\t\t\tvar labelCount = labels ? labels.length : 0;\n\n\t\t\t\tif (tooltipItems.length > 0) {\n\t\t\t\t\tvar item = tooltipItems[0];\n\n\t\t\t\t\tif (item.xLabel) {\n\t\t\t\t\t\ttitle = item.xLabel;\n\t\t\t\t\t} else if (labelCount > 0 && item.index < labelCount) {\n\t\t\t\t\t\ttitle = labels[item.index];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn title;\n\t\t\t},\n\t\t\tafterTitle: helpers.noop,\n\n\t\t\t// Args are: (tooltipItems, data)\n\t\t\tbeforeBody: helpers.noop,\n\n\t\t\t// Args are: (tooltipItem, data)\n\t\t\tbeforeLabel: helpers.noop,\n\t\t\tlabel: function(tooltipItem, data) {\n\t\t\t\tvar label = data.datasets[tooltipItem.datasetIndex].label || '';\n\n\t\t\t\tif (label) {\n\t\t\t\t\tlabel += ': ';\n\t\t\t\t}\n\t\t\t\tlabel += tooltipItem.yLabel;\n\t\t\t\treturn label;\n\t\t\t},\n\t\t\tlabelColor: function(tooltipItem, chart) {\n\t\t\t\tvar meta = chart.getDatasetMeta(tooltipItem.datasetIndex);\n\t\t\t\tvar activeElement = meta.data[tooltipItem.index];\n\t\t\t\tvar view = activeElement._view;\n\t\t\t\treturn {\n\t\t\t\t\tborderColor: view.borderColor,\n\t\t\t\t\tbackgroundColor: view.backgroundColor\n\t\t\t\t};\n\t\t\t},\n\t\t\tlabelTextColor: function() {\n\t\t\t\treturn this._options.bodyFontColor;\n\t\t\t},\n\t\t\tafterLabel: helpers.noop,\n\n\t\t\t// Args are: (tooltipItems, data)\n\t\t\tafterBody: helpers.noop,\n\n\t\t\t// Args are: (tooltipItems, data)\n\t\t\tbeforeFooter: helpers.noop,\n\t\t\tfooter: helpers.noop,\n\t\t\tafterFooter: helpers.noop\n\t\t}\n\t}\n});\n\nmodule.exports = function(Chart) {\n\n\t/**\n \t * Helper method to merge the opacity into a color\n \t */\n\tfunction mergeOpacity(colorString, opacity) {\n\t\tvar color = helpers.color(colorString);\n\t\treturn color.alpha(opacity * color.alpha()).rgbaString();\n\t}\n\n\t// Helper to push or concat based on if the 2nd parameter is an array or not\n\tfunction pushOrConcat(base, toPush) {\n\t\tif (toPush) {\n\t\t\tif (helpers.isArray(toPush)) {\n\t\t\t\t// base = base.concat(toPush);\n\t\t\t\tArray.prototype.push.apply(base, toPush);\n\t\t\t} else {\n\t\t\t\tbase.push(toPush);\n\t\t\t}\n\t\t}\n\n\t\treturn base;\n\t}\n\n\t// Private helper to create a tooltip item model\n\t// @param element : the chart element (point, arc, bar) to create the tooltip item for\n\t// @return : new tooltip item\n\tfunction createTooltipItem(element) {\n\t\tvar xScale = element._xScale;\n\t\tvar yScale = element._yScale || element._scale; // handle radar || polarArea charts\n\t\tvar index = element._index;\n\t\tvar datasetIndex = element._datasetIndex;\n\n\t\treturn {\n\t\t\txLabel: xScale ? xScale.getLabelForIndex(index, datasetIndex) : '',\n\t\t\tyLabel: yScale ? yScale.getLabelForIndex(index, datasetIndex) : '',\n\t\t\tindex: index,\n\t\t\tdatasetIndex: datasetIndex,\n\t\t\tx: element._model.x,\n\t\t\ty: element._model.y\n\t\t};\n\t}\n\n\t/**\n\t * Helper to get the reset model for the tooltip\n\t * @param tooltipOpts {Object} the tooltip options\n\t */\n\tfunction getBaseModel(tooltipOpts) {\n\t\tvar globalDefaults = defaults.global;\n\t\tvar valueOrDefault = helpers.valueOrDefault;\n\n\t\treturn {\n\t\t\t// Positioning\n\t\t\txPadding: tooltipOpts.xPadding,\n\t\t\tyPadding: tooltipOpts.yPadding,\n\t\t\txAlign: tooltipOpts.xAlign,\n\t\t\tyAlign: tooltipOpts.yAlign,\n\n\t\t\t// Body\n\t\t\tbodyFontColor: tooltipOpts.bodyFontColor,\n\t\t\t_bodyFontFamily: valueOrDefault(tooltipOpts.bodyFontFamily, globalDefaults.defaultFontFamily),\n\t\t\t_bodyFontStyle: valueOrDefault(tooltipOpts.bodyFontStyle, globalDefaults.defaultFontStyle),\n\t\t\t_bodyAlign: tooltipOpts.bodyAlign,\n\t\t\tbodyFontSize: valueOrDefault(tooltipOpts.bodyFontSize, globalDefaults.defaultFontSize),\n\t\t\tbodySpacing: tooltipOpts.bodySpacing,\n\n\t\t\t// Title\n\t\t\ttitleFontColor: tooltipOpts.titleFontColor,\n\t\t\t_titleFontFamily: valueOrDefault(tooltipOpts.titleFontFamily, globalDefaults.defaultFontFamily),\n\t\t\t_titleFontStyle: valueOrDefault(tooltipOpts.titleFontStyle, globalDefaults.defaultFontStyle),\n\t\t\ttitleFontSize: valueOrDefault(tooltipOpts.titleFontSize, globalDefaults.defaultFontSize),\n\t\t\t_titleAlign: tooltipOpts.titleAlign,\n\t\t\ttitleSpacing: tooltipOpts.titleSpacing,\n\t\t\ttitleMarginBottom: tooltipOpts.titleMarginBottom,\n\n\t\t\t// Footer\n\t\t\tfooterFontColor: tooltipOpts.footerFontColor,\n\t\t\t_footerFontFamily: valueOrDefault(tooltipOpts.footerFontFamily, globalDefaults.defaultFontFamily),\n\t\t\t_footerFontStyle: valueOrDefault(tooltipOpts.footerFontStyle, globalDefaults.defaultFontStyle),\n\t\t\tfooterFontSize: valueOrDefault(tooltipOpts.footerFontSize, globalDefaults.defaultFontSize),\n\t\t\t_footerAlign: tooltipOpts.footerAlign,\n\t\t\tfooterSpacing: tooltipOpts.footerSpacing,\n\t\t\tfooterMarginTop: tooltipOpts.footerMarginTop,\n\n\t\t\t// Appearance\n\t\t\tcaretSize: tooltipOpts.caretSize,\n\t\t\tcornerRadius: tooltipOpts.cornerRadius,\n\t\t\tbackgroundColor: tooltipOpts.backgroundColor,\n\t\t\topacity: 0,\n\t\t\tlegendColorBackground: tooltipOpts.multiKeyBackground,\n\t\t\tdisplayColors: tooltipOpts.displayColors,\n\t\t\tborderColor: tooltipOpts.borderColor,\n\t\t\tborderWidth: tooltipOpts.borderWidth\n\t\t};\n\t}\n\n\t/**\n\t * Get the size of the tooltip\n\t */\n\tfunction getTooltipSize(tooltip, model) {\n\t\tvar ctx = tooltip._chart.ctx;\n\n\t\tvar height = model.yPadding * 2; // Tooltip Padding\n\t\tvar width = 0;\n\n\t\t// Count of all lines in the body\n\t\tvar body = model.body;\n\t\tvar combinedBodyLength = body.reduce(function(count, bodyItem) {\n\t\t\treturn count + bodyItem.before.length + bodyItem.lines.length + bodyItem.after.length;\n\t\t}, 0);\n\t\tcombinedBodyLength += model.beforeBody.length + model.afterBody.length;\n\n\t\tvar titleLineCount = model.title.length;\n\t\tvar footerLineCount = model.footer.length;\n\t\tvar titleFontSize = model.titleFontSize;\n\t\tvar bodyFontSize = model.bodyFontSize;\n\t\tvar footerFontSize = model.footerFontSize;\n\n\t\theight += titleLineCount * titleFontSize; // Title Lines\n\t\theight += titleLineCount ? (titleLineCount - 1) * model.titleSpacing : 0; // Title Line Spacing\n\t\theight += titleLineCount ? model.titleMarginBottom : 0; // Title's bottom Margin\n\t\theight += combinedBodyLength * bodyFontSize; // Body Lines\n\t\theight += combinedBodyLength ? (combinedBodyLength - 1) * model.bodySpacing : 0; // Body Line Spacing\n\t\theight += footerLineCount ? model.footerMarginTop : 0; // Footer Margin\n\t\theight += footerLineCount * (footerFontSize); // Footer Lines\n\t\theight += footerLineCount ? (footerLineCount - 1) * model.footerSpacing : 0; // Footer Line Spacing\n\n\t\t// Title width\n\t\tvar widthPadding = 0;\n\t\tvar maxLineWidth = function(line) {\n\t\t\twidth = Math.max(width, ctx.measureText(line).width + widthPadding);\n\t\t};\n\n\t\tctx.font = helpers.fontString(titleFontSize, model._titleFontStyle, model._titleFontFamily);\n\t\thelpers.each(model.title, maxLineWidth);\n\n\t\t// Body width\n\t\tctx.font = helpers.fontString(bodyFontSize, model._bodyFontStyle, model._bodyFontFamily);\n\t\thelpers.each(model.beforeBody.concat(model.afterBody), maxLineWidth);\n\n\t\t// Body lines may include some extra width due to the color box\n\t\twidthPadding = model.displayColors ? (bodyFontSize + 2) : 0;\n\t\thelpers.each(body, function(bodyItem) {\n\t\t\thelpers.each(bodyItem.before, maxLineWidth);\n\t\t\thelpers.each(bodyItem.lines, maxLineWidth);\n\t\t\thelpers.each(bodyItem.after, maxLineWidth);\n\t\t});\n\n\t\t// Reset back to 0\n\t\twidthPadding = 0;\n\n\t\t// Footer width\n\t\tctx.font = helpers.fontString(footerFontSize, model._footerFontStyle, model._footerFontFamily);\n\t\thelpers.each(model.footer, maxLineWidth);\n\n\t\t// Add padding\n\t\twidth += 2 * model.xPadding;\n\n\t\treturn {\n\t\t\twidth: width,\n\t\t\theight: height\n\t\t};\n\t}\n\n\t/**\n\t * Helper to get the alignment of a tooltip given the size\n\t */\n\tfunction determineAlignment(tooltip, size) {\n\t\tvar model = tooltip._model;\n\t\tvar chart = tooltip._chart;\n\t\tvar chartArea = tooltip._chart.chartArea;\n\t\tvar xAlign = 'center';\n\t\tvar yAlign = 'center';\n\n\t\tif (model.y < size.height) {\n\t\t\tyAlign = 'top';\n\t\t} else if (model.y > (chart.height - size.height)) {\n\t\t\tyAlign = 'bottom';\n\t\t}\n\n\t\tvar lf, rf; // functions to determine left, right alignment\n\t\tvar olf, orf; // functions to determine if left/right alignment causes tooltip to go outside chart\n\t\tvar yf; // function to get the y alignment if the tooltip goes outside of the left or right edges\n\t\tvar midX = (chartArea.left + chartArea.right) / 2;\n\t\tvar midY = (chartArea.top + chartArea.bottom) / 2;\n\n\t\tif (yAlign === 'center') {\n\t\t\tlf = function(x) {\n\t\t\t\treturn x <= midX;\n\t\t\t};\n\t\t\trf = function(x) {\n\t\t\t\treturn x > midX;\n\t\t\t};\n\t\t} else {\n\t\t\tlf = function(x) {\n\t\t\t\treturn x <= (size.width / 2);\n\t\t\t};\n\t\t\trf = function(x) {\n\t\t\t\treturn x >= (chart.width - (size.width / 2));\n\t\t\t};\n\t\t}\n\n\t\tolf = function(x) {\n\t\t\treturn x + size.width + model.caretSize + model.caretPadding > chart.width;\n\t\t};\n\t\torf = function(x) {\n\t\t\treturn x - size.width - model.caretSize - model.caretPadding < 0;\n\t\t};\n\t\tyf = function(y) {\n\t\t\treturn y <= midY ? 'top' : 'bottom';\n\t\t};\n\n\t\tif (lf(model.x)) {\n\t\t\txAlign = 'left';\n\n\t\t\t// Is tooltip too wide and goes over the right side of the chart.?\n\t\t\tif (olf(model.x)) {\n\t\t\t\txAlign = 'center';\n\t\t\t\tyAlign = yf(model.y);\n\t\t\t}\n\t\t} else if (rf(model.x)) {\n\t\t\txAlign = 'right';\n\n\t\t\t// Is tooltip too wide and goes outside left edge of canvas?\n\t\t\tif (orf(model.x)) {\n\t\t\t\txAlign = 'center';\n\t\t\t\tyAlign = yf(model.y);\n\t\t\t}\n\t\t}\n\n\t\tvar opts = tooltip._options;\n\t\treturn {\n\t\t\txAlign: opts.xAlign ? opts.xAlign : xAlign,\n\t\t\tyAlign: opts.yAlign ? opts.yAlign : yAlign\n\t\t};\n\t}\n\n\t/**\n\t * @Helper to get the location a tooltip needs to be placed at given the initial position (via the vm) and the size and alignment\n\t */\n\tfunction getBackgroundPoint(vm, size, alignment, chart) {\n\t\t// Background Position\n\t\tvar x = vm.x;\n\t\tvar y = vm.y;\n\n\t\tvar caretSize = vm.caretSize;\n\t\tvar caretPadding = vm.caretPadding;\n\t\tvar cornerRadius = vm.cornerRadius;\n\t\tvar xAlign = alignment.xAlign;\n\t\tvar yAlign = alignment.yAlign;\n\t\tvar paddingAndSize = caretSize + caretPadding;\n\t\tvar radiusAndPadding = cornerRadius + caretPadding;\n\n\t\tif (xAlign === 'right') {\n\t\t\tx -= size.width;\n\t\t} else if (xAlign === 'center') {\n\t\t\tx -= (size.width / 2);\n\t\t\tif (x + size.width > chart.width) {\n\t\t\t\tx = chart.width - size.width;\n\t\t\t}\n\t\t\tif (x < 0) {\n\t\t\t\tx = 0;\n\t\t\t}\n\t\t}\n\n\t\tif (yAlign === 'top') {\n\t\t\ty += paddingAndSize;\n\t\t} else if (yAlign === 'bottom') {\n\t\t\ty -= size.height + paddingAndSize;\n\t\t} else {\n\t\t\ty -= (size.height / 2);\n\t\t}\n\n\t\tif (yAlign === 'center') {\n\t\t\tif (xAlign === 'left') {\n\t\t\t\tx += paddingAndSize;\n\t\t\t} else if (xAlign === 'right') {\n\t\t\t\tx -= paddingAndSize;\n\t\t\t}\n\t\t} else if (xAlign === 'left') {\n\t\t\tx -= radiusAndPadding;\n\t\t} else if (xAlign === 'right') {\n\t\t\tx += radiusAndPadding;\n\t\t}\n\n\t\treturn {\n\t\t\tx: x,\n\t\t\ty: y\n\t\t};\n\t}\n\n\tChart.Tooltip = Element.extend({\n\t\tinitialize: function() {\n\t\t\tthis._model = getBaseModel(this._options);\n\t\t\tthis._lastActive = [];\n\t\t},\n\n\t\t// Get the title\n\t\t// Args are: (tooltipItem, data)\n\t\tgetTitle: function() {\n\t\t\tvar me = this;\n\t\t\tvar opts = me._options;\n\t\t\tvar callbacks = opts.callbacks;\n\n\t\t\tvar beforeTitle = callbacks.beforeTitle.apply(me, arguments);\n\t\t\tvar title = callbacks.title.apply(me, arguments);\n\t\t\tvar afterTitle = callbacks.afterTitle.apply(me, arguments);\n\n\t\t\tvar lines = [];\n\t\t\tlines = pushOrConcat(lines, beforeTitle);\n\t\t\tlines = pushOrConcat(lines, title);\n\t\t\tlines = pushOrConcat(lines, afterTitle);\n\n\t\t\treturn lines;\n\t\t},\n\n\t\t// Args are: (tooltipItem, data)\n\t\tgetBeforeBody: function() {\n\t\t\tvar lines = this._options.callbacks.beforeBody.apply(this, arguments);\n\t\t\treturn helpers.isArray(lines) ? lines : lines !== undefined ? [lines] : [];\n\t\t},\n\n\t\t// Args are: (tooltipItem, data)\n\t\tgetBody: function(tooltipItems, data) {\n\t\t\tvar me = this;\n\t\t\tvar callbacks = me._options.callbacks;\n\t\t\tvar bodyItems = [];\n\n\t\t\thelpers.each(tooltipItems, function(tooltipItem) {\n\t\t\t\tvar bodyItem = {\n\t\t\t\t\tbefore: [],\n\t\t\t\t\tlines: [],\n\t\t\t\t\tafter: []\n\t\t\t\t};\n\t\t\t\tpushOrConcat(bodyItem.before, callbacks.beforeLabel.call(me, tooltipItem, data));\n\t\t\t\tpushOrConcat(bodyItem.lines, callbacks.label.call(me, tooltipItem, data));\n\t\t\t\tpushOrConcat(bodyItem.after, callbacks.afterLabel.call(me, tooltipItem, data));\n\n\t\t\t\tbodyItems.push(bodyItem);\n\t\t\t});\n\n\t\t\treturn bodyItems;\n\t\t},\n\n\t\t// Args are: (tooltipItem, data)\n\t\tgetAfterBody: function() {\n\t\t\tvar lines = this._options.callbacks.afterBody.apply(this, arguments);\n\t\t\treturn helpers.isArray(lines) ? lines : lines !== undefined ? [lines] : [];\n\t\t},\n\n\t\t// Get the footer and beforeFooter and afterFooter lines\n\t\t// Args are: (tooltipItem, data)\n\t\tgetFooter: function() {\n\t\t\tvar me = this;\n\t\t\tvar callbacks = me._options.callbacks;\n\n\t\t\tvar beforeFooter = callbacks.beforeFooter.apply(me, arguments);\n\t\t\tvar footer = callbacks.footer.apply(me, arguments);\n\t\t\tvar afterFooter = callbacks.afterFooter.apply(me, arguments);\n\n\t\t\tvar lines = [];\n\t\t\tlines = pushOrConcat(lines, beforeFooter);\n\t\t\tlines = pushOrConcat(lines, footer);\n\t\t\tlines = pushOrConcat(lines, afterFooter);\n\n\t\t\treturn lines;\n\t\t},\n\n\t\tupdate: function(changed) {\n\t\t\tvar me = this;\n\t\t\tvar opts = me._options;\n\n\t\t\t// Need to regenerate the model because its faster than using extend and it is necessary due to the optimization in Chart.Element.transition\n\t\t\t// that does _view = _model if ease === 1. This causes the 2nd tooltip update to set properties in both the view and model at the same time\n\t\t\t// which breaks any animations.\n\t\t\tvar existingModel = me._model;\n\t\t\tvar model = me._model = getBaseModel(opts);\n\t\t\tvar active = me._active;\n\n\t\t\tvar data = me._data;\n\n\t\t\t// In the case where active.length === 0 we need to keep these at existing values for good animations\n\t\t\tvar alignment = {\n\t\t\t\txAlign: existingModel.xAlign,\n\t\t\t\tyAlign: existingModel.yAlign\n\t\t\t};\n\t\t\tvar backgroundPoint = {\n\t\t\t\tx: existingModel.x,\n\t\t\t\ty: existingModel.y\n\t\t\t};\n\t\t\tvar tooltipSize = {\n\t\t\t\twidth: existingModel.width,\n\t\t\t\theight: existingModel.height\n\t\t\t};\n\t\t\tvar tooltipPosition = {\n\t\t\t\tx: existingModel.caretX,\n\t\t\t\ty: existingModel.caretY\n\t\t\t};\n\n\t\t\tvar i, len;\n\n\t\t\tif (active.length) {\n\t\t\t\tmodel.opacity = 1;\n\n\t\t\t\tvar labelColors = [];\n\t\t\t\tvar labelTextColors = [];\n\t\t\t\ttooltipPosition = Chart.Tooltip.positioners[opts.position].call(me, active, me._eventPosition);\n\n\t\t\t\tvar tooltipItems = [];\n\t\t\t\tfor (i = 0, len = active.length; i < len; ++i) {\n\t\t\t\t\ttooltipItems.push(createTooltipItem(active[i]));\n\t\t\t\t}\n\n\t\t\t\t// If the user provided a filter function, use it to modify the tooltip items\n\t\t\t\tif (opts.filter) {\n\t\t\t\t\ttooltipItems = tooltipItems.filter(function(a) {\n\t\t\t\t\t\treturn opts.filter(a, data);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// If the user provided a sorting function, use it to modify the tooltip items\n\t\t\t\tif (opts.itemSort) {\n\t\t\t\t\ttooltipItems = tooltipItems.sort(function(a, b) {\n\t\t\t\t\t\treturn opts.itemSort(a, b, data);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Determine colors for boxes\n\t\t\t\thelpers.each(tooltipItems, function(tooltipItem) {\n\t\t\t\t\tlabelColors.push(opts.callbacks.labelColor.call(me, tooltipItem, me._chart));\n\t\t\t\t\tlabelTextColors.push(opts.callbacks.labelTextColor.call(me, tooltipItem, me._chart));\n\t\t\t\t});\n\n\n\t\t\t\t// Build the Text Lines\n\t\t\t\tmodel.title = me.getTitle(tooltipItems, data);\n\t\t\t\tmodel.beforeBody = me.getBeforeBody(tooltipItems, data);\n\t\t\t\tmodel.body = me.getBody(tooltipItems, data);\n\t\t\t\tmodel.afterBody = me.getAfterBody(tooltipItems, data);\n\t\t\t\tmodel.footer = me.getFooter(tooltipItems, data);\n\n\t\t\t\t// Initial positioning and colors\n\t\t\t\tmodel.x = Math.round(tooltipPosition.x);\n\t\t\t\tmodel.y = Math.round(tooltipPosition.y);\n\t\t\t\tmodel.caretPadding = opts.caretPadding;\n\t\t\t\tmodel.labelColors = labelColors;\n\t\t\t\tmodel.labelTextColors = labelTextColors;\n\n\t\t\t\t// data points\n\t\t\t\tmodel.dataPoints = tooltipItems;\n\n\t\t\t\t// We need to determine alignment of the tooltip\n\t\t\t\ttooltipSize = getTooltipSize(this, model);\n\t\t\t\talignment = determineAlignment(this, tooltipSize);\n\t\t\t\t// Final Size and Position\n\t\t\t\tbackgroundPoint = getBackgroundPoint(model, tooltipSize, alignment, me._chart);\n\t\t\t} else {\n\t\t\t\tmodel.opacity = 0;\n\t\t\t}\n\n\t\t\tmodel.xAlign = alignment.xAlign;\n\t\t\tmodel.yAlign = alignment.yAlign;\n\t\t\tmodel.x = backgroundPoint.x;\n\t\t\tmodel.y = backgroundPoint.y;\n\t\t\tmodel.width = tooltipSize.width;\n\t\t\tmodel.height = tooltipSize.height;\n\n\t\t\t// Point where the caret on the tooltip points to\n\t\t\tmodel.caretX = tooltipPosition.x;\n\t\t\tmodel.caretY = tooltipPosition.y;\n\n\t\t\tme._model = model;\n\n\t\t\tif (changed && opts.custom) {\n\t\t\t\topts.custom.call(me, model);\n\t\t\t}\n\n\t\t\treturn me;\n\t\t},\n\t\tdrawCaret: function(tooltipPoint, size) {\n\t\t\tvar ctx = this._chart.ctx;\n\t\t\tvar vm = this._view;\n\t\t\tvar caretPosition = this.getCaretPosition(tooltipPoint, size, vm);\n\n\t\t\tctx.lineTo(caretPosition.x1, caretPosition.y1);\n\t\t\tctx.lineTo(caretPosition.x2, caretPosition.y2);\n\t\t\tctx.lineTo(caretPosition.x3, caretPosition.y3);\n\t\t},\n\t\tgetCaretPosition: function(tooltipPoint, size, vm) {\n\t\t\tvar x1, x2, x3, y1, y2, y3;\n\t\t\tvar caretSize = vm.caretSize;\n\t\t\tvar cornerRadius = vm.cornerRadius;\n\t\t\tvar xAlign = vm.xAlign;\n\t\t\tvar yAlign = vm.yAlign;\n\t\t\tvar ptX = tooltipPoint.x;\n\t\t\tvar ptY = tooltipPoint.y;\n\t\t\tvar width = size.width;\n\t\t\tvar height = size.height;\n\n\t\t\tif (yAlign === 'center') {\n\t\t\t\ty2 = ptY + (height / 2);\n\n\t\t\t\tif (xAlign === 'left') {\n\t\t\t\t\tx1 = ptX;\n\t\t\t\t\tx2 = x1 - caretSize;\n\t\t\t\t\tx3 = x1;\n\n\t\t\t\t\ty1 = y2 + caretSize;\n\t\t\t\t\ty3 = y2 - caretSize;\n\t\t\t\t} else {\n\t\t\t\t\tx1 = ptX + width;\n\t\t\t\t\tx2 = x1 + caretSize;\n\t\t\t\t\tx3 = x1;\n\n\t\t\t\t\ty1 = y2 - caretSize;\n\t\t\t\t\ty3 = y2 + caretSize;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (xAlign === 'left') {\n\t\t\t\t\tx2 = ptX + cornerRadius + (caretSize);\n\t\t\t\t\tx1 = x2 - caretSize;\n\t\t\t\t\tx3 = x2 + caretSize;\n\t\t\t\t} else if (xAlign === 'right') {\n\t\t\t\t\tx2 = ptX + width - cornerRadius - caretSize;\n\t\t\t\t\tx1 = x2 - caretSize;\n\t\t\t\t\tx3 = x2 + caretSize;\n\t\t\t\t} else {\n\t\t\t\t\tx2 = vm.caretX;\n\t\t\t\t\tx1 = x2 - caretSize;\n\t\t\t\t\tx3 = x2 + caretSize;\n\t\t\t\t}\n\t\t\t\tif (yAlign === 'top') {\n\t\t\t\t\ty1 = ptY;\n\t\t\t\t\ty2 = y1 - caretSize;\n\t\t\t\t\ty3 = y1;\n\t\t\t\t} else {\n\t\t\t\t\ty1 = ptY + height;\n\t\t\t\t\ty2 = y1 + caretSize;\n\t\t\t\t\ty3 = y1;\n\t\t\t\t\t// invert drawing order\n\t\t\t\t\tvar tmp = x3;\n\t\t\t\t\tx3 = x1;\n\t\t\t\t\tx1 = tmp;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {x1: x1, x2: x2, x3: x3, y1: y1, y2: y2, y3: y3};\n\t\t},\n\t\tdrawTitle: function(pt, vm, ctx, opacity) {\n\t\t\tvar title = vm.title;\n\n\t\t\tif (title.length) {\n\t\t\t\tctx.textAlign = vm._titleAlign;\n\t\t\t\tctx.textBaseline = 'top';\n\n\t\t\t\tvar titleFontSize = vm.titleFontSize;\n\t\t\t\tvar titleSpacing = vm.titleSpacing;\n\n\t\t\t\tctx.fillStyle = mergeOpacity(vm.titleFontColor, opacity);\n\t\t\t\tctx.font = helpers.fontString(titleFontSize, vm._titleFontStyle, vm._titleFontFamily);\n\n\t\t\t\tvar i, len;\n\t\t\t\tfor (i = 0, len = title.length; i < len; ++i) {\n\t\t\t\t\tctx.fillText(title[i], pt.x, pt.y);\n\t\t\t\t\tpt.y += titleFontSize + titleSpacing; // Line Height and spacing\n\n\t\t\t\t\tif (i + 1 === title.length) {\n\t\t\t\t\t\tpt.y += vm.titleMarginBottom - titleSpacing; // If Last, add margin, remove spacing\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tdrawBody: function(pt, vm, ctx, opacity) {\n\t\t\tvar bodyFontSize = vm.bodyFontSize;\n\t\t\tvar bodySpacing = vm.bodySpacing;\n\t\t\tvar body = vm.body;\n\n\t\t\tctx.textAlign = vm._bodyAlign;\n\t\t\tctx.textBaseline = 'top';\n\t\t\tctx.font = helpers.fontString(bodyFontSize, vm._bodyFontStyle, vm._bodyFontFamily);\n\n\t\t\t// Before Body\n\t\t\tvar xLinePadding = 0;\n\t\t\tvar fillLineOfText = function(line) {\n\t\t\t\tctx.fillText(line, pt.x + xLinePadding, pt.y);\n\t\t\t\tpt.y += bodyFontSize + bodySpacing;\n\t\t\t};\n\n\t\t\t// Before body lines\n\t\t\tctx.fillStyle = mergeOpacity(vm.bodyFontColor, opacity);\n\t\t\thelpers.each(vm.beforeBody, fillLineOfText);\n\n\t\t\tvar drawColorBoxes = vm.displayColors;\n\t\t\txLinePadding = drawColorBoxes ? (bodyFontSize + 2) : 0;\n\n\t\t\t// Draw body lines now\n\t\t\thelpers.each(body, function(bodyItem, i) {\n\t\t\t\tvar textColor = mergeOpacity(vm.labelTextColors[i], opacity);\n\t\t\t\tctx.fillStyle = textColor;\n\t\t\t\thelpers.each(bodyItem.before, fillLineOfText);\n\n\t\t\t\thelpers.each(bodyItem.lines, function(line) {\n\t\t\t\t\t// Draw Legend-like boxes if needed\n\t\t\t\t\tif (drawColorBoxes) {\n\t\t\t\t\t\t// Fill a white rect so that colours merge nicely if the opacity is < 1\n\t\t\t\t\t\tctx.fillStyle = mergeOpacity(vm.legendColorBackground, opacity);\n\t\t\t\t\t\tctx.fillRect(pt.x, pt.y, bodyFontSize, bodyFontSize);\n\n\t\t\t\t\t\t// Border\n\t\t\t\t\t\tctx.lineWidth = 1;\n\t\t\t\t\t\tctx.strokeStyle = mergeOpacity(vm.labelColors[i].borderColor, opacity);\n\t\t\t\t\t\tctx.strokeRect(pt.x, pt.y, bodyFontSize, bodyFontSize);\n\n\t\t\t\t\t\t// Inner square\n\t\t\t\t\t\tctx.fillStyle = mergeOpacity(vm.labelColors[i].backgroundColor, opacity);\n\t\t\t\t\t\tctx.fillRect(pt.x + 1, pt.y + 1, bodyFontSize - 2, bodyFontSize - 2);\n\t\t\t\t\t\tctx.fillStyle = textColor;\n\t\t\t\t\t}\n\n\t\t\t\t\tfillLineOfText(line);\n\t\t\t\t});\n\n\t\t\t\thelpers.each(bodyItem.after, fillLineOfText);\n\t\t\t});\n\n\t\t\t// Reset back to 0 for after body\n\t\t\txLinePadding = 0;\n\n\t\t\t// After body lines\n\t\t\thelpers.each(vm.afterBody, fillLineOfText);\n\t\t\tpt.y -= bodySpacing; // Remove last body spacing\n\t\t},\n\t\tdrawFooter: function(pt, vm, ctx, opacity) {\n\t\t\tvar footer = vm.footer;\n\n\t\t\tif (footer.length) {\n\t\t\t\tpt.y += vm.footerMarginTop;\n\n\t\t\t\tctx.textAlign = vm._footerAlign;\n\t\t\t\tctx.textBaseline = 'top';\n\n\t\t\t\tctx.fillStyle = mergeOpacity(vm.footerFontColor, opacity);\n\t\t\t\tctx.font = helpers.fontString(vm.footerFontSize, vm._footerFontStyle, vm._footerFontFamily);\n\n\t\t\t\thelpers.each(footer, function(line) {\n\t\t\t\t\tctx.fillText(line, pt.x, pt.y);\n\t\t\t\t\tpt.y += vm.footerFontSize + vm.footerSpacing;\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tdrawBackground: function(pt, vm, ctx, tooltipSize, opacity) {\n\t\t\tctx.fillStyle = mergeOpacity(vm.backgroundColor, opacity);\n\t\t\tctx.strokeStyle = mergeOpacity(vm.borderColor, opacity);\n\t\t\tctx.lineWidth = vm.borderWidth;\n\t\t\tvar xAlign = vm.xAlign;\n\t\t\tvar yAlign = vm.yAlign;\n\t\t\tvar x = pt.x;\n\t\t\tvar y = pt.y;\n\t\t\tvar width = tooltipSize.width;\n\t\t\tvar height = tooltipSize.height;\n\t\t\tvar radius = vm.cornerRadius;\n\n\t\t\tctx.beginPath();\n\t\t\tctx.moveTo(x + radius, y);\n\t\t\tif (yAlign === 'top') {\n\t\t\t\tthis.drawCaret(pt, tooltipSize);\n\t\t\t}\n\t\t\tctx.lineTo(x + width - radius, y);\n\t\t\tctx.quadraticCurveTo(x + width, y, x + width, y + radius);\n\t\t\tif (yAlign === 'center' && xAlign === 'right') {\n\t\t\t\tthis.drawCaret(pt, tooltipSize);\n\t\t\t}\n\t\t\tctx.lineTo(x + width, y + height - radius);\n\t\t\tctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n\t\t\tif (yAlign === 'bottom') {\n\t\t\t\tthis.drawCaret(pt, tooltipSize);\n\t\t\t}\n\t\t\tctx.lineTo(x + radius, y + height);\n\t\t\tctx.quadraticCurveTo(x, y + height, x, y + height - radius);\n\t\t\tif (yAlign === 'center' && xAlign === 'left') {\n\t\t\t\tthis.drawCaret(pt, tooltipSize);\n\t\t\t}\n\t\t\tctx.lineTo(x, y + radius);\n\t\t\tctx.quadraticCurveTo(x, y, x + radius, y);\n\t\t\tctx.closePath();\n\n\t\t\tctx.fill();\n\n\t\t\tif (vm.borderWidth > 0) {\n\t\t\t\tctx.stroke();\n\t\t\t}\n\t\t},\n\t\tdraw: function() {\n\t\t\tvar ctx = this._chart.ctx;\n\t\t\tvar vm = this._view;\n\n\t\t\tif (vm.opacity === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar tooltipSize = {\n\t\t\t\twidth: vm.width,\n\t\t\t\theight: vm.height\n\t\t\t};\n\t\t\tvar pt = {\n\t\t\t\tx: vm.x,\n\t\t\t\ty: vm.y\n\t\t\t};\n\n\t\t\t// IE11/Edge does not like very small opacities, so snap to 0\n\t\t\tvar opacity = Math.abs(vm.opacity < 1e-3) ? 0 : vm.opacity;\n\n\t\t\t// Truthy/falsey value for empty tooltip\n\t\t\tvar hasTooltipContent = vm.title.length || vm.beforeBody.length || vm.body.length || vm.afterBody.length || vm.footer.length;\n\n\t\t\tif (this._options.enabled && hasTooltipContent) {\n\t\t\t\t// Draw Background\n\t\t\t\tthis.drawBackground(pt, vm, ctx, tooltipSize, opacity);\n\n\t\t\t\t// Draw Title, Body, and Footer\n\t\t\t\tpt.x += vm.xPadding;\n\t\t\t\tpt.y += vm.yPadding;\n\n\t\t\t\t// Titles\n\t\t\t\tthis.drawTitle(pt, vm, ctx, opacity);\n\n\t\t\t\t// Body\n\t\t\t\tthis.drawBody(pt, vm, ctx, opacity);\n\n\t\t\t\t// Footer\n\t\t\t\tthis.drawFooter(pt, vm, ctx, opacity);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Handle an event\n\t\t * @private\n\t\t * @param {IEvent} event - The event to handle\n\t\t * @returns {Boolean} true if the tooltip changed\n\t\t */\n\t\thandleEvent: function(e) {\n\t\t\tvar me = this;\n\t\t\tvar options = me._options;\n\t\t\tvar changed = false;\n\n\t\t\tme._lastActive = me._lastActive || [];\n\n\t\t\t// Find Active Elements for tooltips\n\t\t\tif (e.type === 'mouseout') {\n\t\t\t\tme._active = [];\n\t\t\t} else {\n\t\t\t\tme._active = me._chart.getElementsAtEventForMode(e, options.mode, options);\n\t\t\t}\n\n\t\t\t// Remember Last Actives\n\t\t\tchanged = !helpers.arrayEquals(me._active, me._lastActive);\n\n\t\t\t// Only handle target event on tooltip change\n\t\t\tif (changed) {\n\t\t\t\tme._lastActive = me._active;\n\n\t\t\t\tif (options.enabled || options.custom) {\n\t\t\t\t\tme._eventPosition = {\n\t\t\t\t\t\tx: e.x,\n\t\t\t\t\t\ty: e.y\n\t\t\t\t\t};\n\n\t\t\t\t\tme.update(true);\n\t\t\t\t\tme.pivot();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn changed;\n\t\t}\n\t});\n\n\t/**\n\t * @namespace Chart.Tooltip.positioners\n\t */\n\tChart.Tooltip.positioners = {\n\t\t/**\n\t\t * Average mode places the tooltip at the average position of the elements shown\n\t\t * @function Chart.Tooltip.positioners.average\n\t\t * @param elements {ChartElement[]} the elements being displayed in the tooltip\n\t\t * @returns {Point} tooltip position\n\t\t */\n\t\taverage: function(elements) {\n\t\t\tif (!elements.length) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar i, len;\n\t\t\tvar x = 0;\n\t\t\tvar y = 0;\n\t\t\tvar count = 0;\n\n\t\t\tfor (i = 0, len = elements.length; i < len; ++i) {\n\t\t\t\tvar el = elements[i];\n\t\t\t\tif (el && el.hasValue()) {\n\t\t\t\t\tvar pos = el.tooltipPosition();\n\t\t\t\t\tx += pos.x;\n\t\t\t\t\ty += pos.y;\n\t\t\t\t\t++count;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tx: Math.round(x / count),\n\t\t\t\ty: Math.round(y / count)\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Gets the tooltip position nearest of the item nearest to the event position\n\t\t * @function Chart.Tooltip.positioners.nearest\n\t\t * @param elements {Chart.Element[]} the tooltip elements\n\t\t * @param eventPosition {Point} the position of the event in canvas coordinates\n\t\t * @returns {Point} the tooltip position\n\t\t */\n\t\tnearest: function(elements, eventPosition) {\n\t\t\tvar x = eventPosition.x;\n\t\t\tvar y = eventPosition.y;\n\t\t\tvar minDistance = Number.POSITIVE_INFINITY;\n\t\t\tvar i, len, nearestElement;\n\n\t\t\tfor (i = 0, len = elements.length; i < len; ++i) {\n\t\t\t\tvar el = elements[i];\n\t\t\t\tif (el && el.hasValue()) {\n\t\t\t\t\tvar center = el.getCenterPoint();\n\t\t\t\t\tvar d = helpers.distanceBetweenPoints(eventPosition, center);\n\n\t\t\t\t\tif (d < minDistance) {\n\t\t\t\t\t\tminDistance = d;\n\t\t\t\t\t\tnearestElement = el;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (nearestElement) {\n\t\t\t\tvar tp = nearestElement.tooltipPosition();\n\t\t\t\tx = tp.x;\n\t\t\t\ty = tp.y;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tx: x,\n\t\t\t\ty: y\n\t\t\t};\n\t\t}\n\t};\n};\n"]},"metadata":{},"sourceType":"script"}